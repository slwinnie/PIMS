<%@ Page Language="C#" %>
<%
    var editId = Convert.ToInt32(Request["Id"]);
    var editTitle = Request["editTitle"];
    var editLevelNo = Request["editLevelNo"];
    var editPos = Request["editPos"];
    var editOwnerId = Request["editOwnerId"];
    var editParentId = Request["editParentId"];

    var db = new PPPEntities();
    if (string.IsNullOrEmpty(editPos))
    {
        editPos = "1";
    }
    if (string.IsNullOrEmpty(editTitle))
    {
        editTitle = "Title";
    }

    var organization = db.TOrganization.FirstOrDefault(x => x.Id == editId);
    if (organization == null)
    {
        var sb = new StringBuilder();
        sb.AppendFormat("{{");
        sb.AppendFormat("\"{0}\":\"{1}\", ", "ErrorCode", "-1");
        sb.AppendFormat("\"{0}\":\"{1}\"  ", "ErrorMessage", "Invalid Id.");
        sb.AppendFormat("}}");
        Response.Write(sb.ToString());
        return;
    }
    if (!string.IsNullOrEmpty(editParentId))
    {
        organization.ParentId = Convert.ToInt32(editParentId);
    }
    else
    {
        organization.ParentId = null;
    }

    organization.Title = editTitle;
    organization.LevelNo = Convert.ToInt32(editLevelNo);
    organization.LevelPos = Convert.ToInt32(editPos);
    if (!string.IsNullOrEmpty(editOwnerId))
    {
        organization.OwnerId = Convert.ToInt32(editOwnerId);
    }
    else
    {
        organization.OwnerId = null;
    }
    db.SaveChanges();
    {
        var sb = new StringBuilder();
        sb.AppendFormat("{{");
        sb.AppendFormat("\"{0}\":\"{1}\", ", "ErrorCode", "0");
        sb.AppendFormat("\"{0}\":\"{1}\"  ", "ErrorMessage", "OK.");
        sb.AppendFormat("}}");
        Response.Write(sb.ToString());
        return;
    }


%>