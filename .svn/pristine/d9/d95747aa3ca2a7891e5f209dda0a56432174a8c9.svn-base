$(function () {
    $(".save-change").click(function () {
        var url = "Actions/BidFormSaveChange.aspx?1=1";
        url += "&projectId=" + $("#projectId").val();
        url += "&subId=" + $("#subId").val();
        url += "&c1=" + $("#c1").is(':checked');
        url += "&c2=" + $("#c2").is(':checked');
        url += "&c3=" + $("#c3").is(':checked');
        url += "&c4=" + $("#c4").is(':checked');
        url += "&c5=" + $("#c5").is(':checked');
        url += "&c6=" + $("#c6").is(':checked');
        url += "&c7=" + $("#c7").is(':checked');
        url += "&c8=" + $("#c8").is(':checked');
        url += "&c9=" + $("#c9").is(':checked');
        url += "&c10=" + $("#c10").is(':checked');
        url += "&c11=" + $("#c11").is(':checked');
        url += "&c12=" + $("#c12").is(':checked');
        url += "&c13=" + $("#c13").is(':checked');
        url += "&c14=" + $("#c14").is(':checked');
        url += "&c15=" + $("#c15").is(':checked');
        url += "&c16=" + $("#c16").is(':checked');
        url += "&c17=" + $("#c17").is(':checked');
        url += "&c18=" + $("#c18").is(':checked');
        url += "&c19=" + $("#c19").is(':checked');
        url += "&c20=" + $("#c20").is(':checked');
        url += "&c21=" + $("#c21").is(':checked');
        url += "&c22=" + $("#c22").is(':checked');
        url += "&c23=" + $("#c23").is(':checked');
        url += "&c24=" + $("#c24").is(':checked');
        url += "&c25=" + $("#c25").is(':checked');
        url += "&c26=" + $("#c26").is(':checked');
        url += "&c27=" + $("#c27").is(':checked');
        url += "&c28=" + $("#c28").is(':checked');
        url += "&c29=" + $("#c29").is(':checked');
        url += "&c30=" + $("#c30").is(':checked');
        url += "&c31=" + $("#c31").is(':checked');
        url += "&c32=" + $("#c32").is(':checked');
        url += "&c33=" + $("#c33").is(':checked');
        url += "&c34=" + $("#c34").is(':checked');
        url += "&c35=" + $("#c35").is(':checked');
        url += "&c36=" + $("#c36").is(':checked');
        url += "&c37=" + $("#c37").is(':checked');
        url += "&c38=" + $("#c38").is(':checked');
        url += "&c39=" + $("#c39").is(':checked');
        url += "&c40=" + $("#c40").is(':checked');
        url += "&c41=" + $("#c41").is(':checked');
        url += "&c42=" + $("#c42").is(':checked');
        url += "&c43=" + $("#c43").is(':checked');
        url += "&c44=" + $("#c44").is(':checked');
        url += "&c45=" + $("#c45").is(':checked');
        url += "&c46=" + $("#c46").is(':checked');
        url += "&c47=" + $("#c47").is(':checked');
        url += "&c48=" + $("#c48").is(':checked');
        url += "&c49=" + $("#c49").is(':checked');
        url += "&c50=" + $("#c50").is(':checked');
        url += "&c51=" + $("#c51").is(':checked');
        url += "&c52=" + $("#c52").is(':checked');
        url += "&c53=" + $("#c53").is(':checked');
        url += "&c54=" + $("#c54").is(':checked');
        url += "&c55=" + $("#c55").is(':checked');
        url += "&c56=" + $("#c56").is(':checked');
        url += "&c57=" + $("#c57").is(':checked');
        url += "&c58=" + $("#c58").is(':checked');
        url += "&c59=" + $("#c59").is(':checked');
        url += "&c60=" + $("#c60").is(':checked');
        url += "&c61=" + $("#c61").is(':checked');
        url += "&c62=" + $("#c62").is(':checked');
        url += "&c63=" + $("#c63").is(':checked');
        url += "&c64=" + $("#c64").is(':checked');
        url += "&c65=" + $("#c65").is(':checked');
        url += "&c66=" + $("#c66").is(':checked');
        url += "&c67=" + $("#c67").is(':checked');
        url += "&c68=" + $("#c68").is(':checked');
        url += "&c69=" + $("#c69").is(':checked');
        url += "&c70=" + $("#c70").is(':checked');
        url += "&c71=" + $("#c71").is(':checked');
        url += "&c72=" + $("#c72").is(':checked');
        url += "&c73=" + $("#c73").is(':checked');
        url += "&c74=" + $("#c74").is(':checked');
        url += "&c75=" + $("#c75").is(':checked');
        url += "&c76=" + $("#c76").is(':checked');
        url += "&c77=" + $("#c77").is(':checked');
        url += "&c78=" + $("#c78").is(':checked');
        url += "&c79=" + $("#c79").is(':checked');
        url += "&c80=" + $("#c80").is(':checked');
        url += "&c81=" + $("#c81").is(':checked');
        url += "&c82=" + $("#c82").is(':checked');
        url += "&c83=" + $("#c83").is(':checked');
        url += "&c84=" + $("#c84").is(':checked');
        url += "&c85=" + $("#c85").is(':checked');
        url += "&c86=" + $("#c86").is(':checked');
        url += "&t1=" + $("#t1").val();
        url += "&t2=" + $("#t2").val();
        url += "&t3=" + $("#t3").val();
        url += "&t4=" + $("#t4").val();
        url += "&t5=" + $("#t5").val();
        url += "&t6=" + $("#t6").val();
        url += "&t7=" + $("#t7").val();
        url += "&t8=" + $("#t8").val();
        url += "&t9=" + $("#t9").val();
        url += "&t10=" + $("#t10").val();
        url += "&t11=" + $("#t11").val();
        url += "&t12=" + $("#t12").val();
        url += "&t13=" + $("#t13").val();
        url += "&t14=" + $("#t14").val();
        url += "&t15=" + $("#t15").val();
        url += "&t16=" + $("#t16").val();
        url += "&t17=" + $("#t17").val();
        url += "&t18=" + $("#t18").val();
        url += "&t19=" + $("#t19").val();
        url += "&t20=" + $("#t20").val();
        url += "&t21=" + $("#t21").val();
        url += "&t22=" + $("#t22").val();
        url += "&t23=" + $("#t23").val();
        url += "&t24=" + $("#t24").val();
        url += "&t25=" + $("#t25").val();
        url += "&t26=" + $("#t26").val();
        url += "&t27=" + $("#t27").val();
        url += "&t28=" + $("#t28").val();
        url += "&t29=" + $("#t29").val();
        url += "&t30=" + $("#t30").val();
        url += "&t31=" + $("#t31").val();
        url += "&t32=" + $("#t32").val();
        url += "&t33=" + $("#t33").val();
        url += "&t34=" + $("#t34").val();
        url += "&t35=" + $("#t35").val();
        url += "&t36=" + $("#t36").val();
        url += "&t37=" + $("#t37").val();
        url += "&t38=" + $("#t38").val();
        url += "&t39=" + $("#t39").val();
        url += "&t40=" + $("#t40").val();
        url += "&t41=" + $("#t41").val();
        url += "&t42=" + $("#t42").val();
        url += "&t43=" + $("#t43").val();
        url += "&t44=" + $("#t44").val();
        url += "&t45=" + $("#t45").val();
        url += "&t46=" + $("#t46").val();
        url += "&t47=" + $("#t47").val();
        url += "&t48=" + $("#t48").val();
        url += "&t49=" + $("#t49").val();
        url += "&t50=" + $("#t50").val();
        url += "&t51=" + $("#t51").val();
        url += "&t52=" + $("#t52").val();
        url += "&t53=" + $("#t53").val();
        url += "&t54=" + $("#t54").val();
        url += "&t55=" + $("#t55").val();
        url += "&t56=" + $("#t56").val();
        url += "&t57=" + $("#t57").val();
        url += "&t58=" + $("#t58").val();
        url += "&t59=" + $("#t59").val();
        url += "&t60=" + $("#t60").val();
        url += "&t61=" + $("#t61").val();
        url += "&t62=" + $("#t62").val();
        url += "&t63=" + $("#t63").val();
        url += "&t64=" + $("#t64").val();
        url += "&t65=" + $("#t65").val();
        url += "&t66=" + $("#t66").val();
        url += "&t67=" + $("#t67").val();
        url += "&t68=" + $("#t68").val();
        url += "&t69=" + $("#t69").val();
        url += "&t70=" + $("#t70").val();
        url += "&t71=" + $("#t71").val();
        url += "&t72=" + $("#t72").val();
        url += "&t73=" + $("#t73").val();
        url += "&t74=" + $("#t74").val();
        url += "&t75=" + $("#t75").val();
        url += "&t76=" + $("#t76").val();
        url += "&t77=" + $("#t77").val();

        url += "&t78=" + $("#txtBidDate").val();
        url += "&t79=" + $("#txtAwardDate").val();
        url += "&t80=" + $("#txtContractDuration").val();

        url += "&t81=" + $("#txtProjectName").val();
        url += "&t82=" + $("#txtWorkShareOffice").val();
        url += "&t83=" + $("#txtCustomer").val();
        url += "&t84=" + $("#txtFacilityLocationCountry").val();
        url += "&t85=" + $("#txtBidOffice").val();
        //alert(url);
        $.ajax(url, {
            type: "post",
            success: function (d) {
                try {
                    var rst = JSON.parse(d);
                    if (rst.ErrorCode === "0") {
                        alert(rst.ErrorMessage);
                    } else {
                        alert(rst.ErrorMessage);
                    }
                } catch (e) {
                    alert(e);
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                /*弹出jqXHR对象的信息*/
                //alert(jqXHR.responseText);
                alert(jqXHR.status);
                //alert(jqXHR.readyState);
                //alert(jqXHR.statusText);
                /*弹出其他两个参数的信息*/
                //alert(textStatus);
                //alert(errorThrown);
            }
        });
        return false;
    });

    $(".ready-for-approval").click(function () {
        if ($("#txtBidDate").val() === "") {
            alert("[Bid Due Date] is required.");
            return false;
        }
        if ($("#txtAwardDate").val() === "") {
            alert("[Award Date] is required.");
            return false;
        }
        if ($("#t10").val() === "") {
            alert("[RFP Release Date] is required.");
            return false;
        }
        if ($("#txtContractDuration").val() === "") {
            alert("[Project Duration] is required.");
            return false;
        }
        if ($("#t63").val() === "") {
            alert("[Location Manager] is required.");
            return false;
        }
        if ($("#t65").val() === "") {
            alert("[Location/Region CSG/BD Director] is required.");
            return false;
        }

        $.ajax({
            url: 'Actions/BidFormReady4Approval.aspx?projectId=' + $("#projectId").val() + "&subId=" + $("#subId").val(),
            type: "post",
            datatype: "json",
            success: function () {
                alert("success");
            },
            error: function (jqXHR, textStatus, errorThrown) {
                /*弹出jqXHR对象的信息*/
                alert(jqXHR.responseText);
                alert(jqXHR.status);
                alert(jqXHR.readyState);
                alert(jqXHR.statusText);
                /*弹出其他两个参数的信息*/
                alert(textStatus);
                alert(errorThrown);

            }
        });

        return false;
    });

    $(".expediting").click(function() {
        $("#modalDialog-exediting-confirm").modal("show");

        return false;
    });

    $(".exediting-confirm").click(function () {
        $("#modalDialog-exediting-confirm").modal("hide");

        $.ajax({
            url: 'Actions/BidFormExediting.aspx?projectId=' + $("#projectId").val() + "&subId=" + $("#subId").val(),
            type: "post",
            datatype: "json",
            success: function () {
                alert("successful");
            },
            error: function (jqXHR, textStatus, errorThrown) {
                /*弹出jqXHR对象的信息*/
                alert(jqXHR.responseText);
                alert(jqXHR.status);
                alert(jqXHR.readyState);
                alert(jqXHR.statusText);
                /*弹出其他两个参数的信息*/
                alert(textStatus);
                alert(errorThrown);

            }
        });

        return false;
    });

    $(".delete-attach-row").click(function () {
        $(".delete-attach").data("projectId", $(this).parent().parent().find("td:eq(0) span:eq(0)").html());
        $(".delete-attach").data("subId", $(this).parent().parent().find("td:eq(0) span:eq(1)").html());
        $(".delete-attach").data("seq", $(this).parent().parent().find("td:eq(0) span:eq(2)").html());

        $("#modalDialog-delete-attach").modal("show");
        return false;
    });

    $(".delete-attach").click(function () {
        //var projectId = $(this).parent().parent().find("td:eq(0) span:eq(0)").html();
        //var subId = $(this).parent().parent().find("td:eq(0) span:eq(1)").html();
        //var type = $(this).parent().parent().find("td:eq(0) span:eq(2)").html();
        //var seq = $(this).parent().parent().find("td:eq(0) span:eq(3)").html();

        var projectId = $(this).data("projectId");
        var subId = $(this).data("subId");
        var seq = $(this).data("seq");
        $.ajax({
            url: 'Actions/BNBFormDeleteAttach.aspx?projectId=' + projectId
                + "&subId=" + subId
                + "&seq=" + seq,
            type: "post",
            datatype: "json",
            success: function (d) {
                $("#modalDialog-delete-attach").modal("toggle");
                try {
                    var rst = JSON.parse(d);
                    if (rst.ErrorCode === "0") {
                        //alert(rst.ErrorMessage);
                        location.reload();

                    } else {
                        alert(rst.ErrorMessage);
                    }
                } catch (e) {
                    alert(e);
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                /*弹出jqXHR对象的信息*/
                //alert(jqXHR.responseText);
                alert(jqXHR.status);
                //alert(jqXHR.readyState);
                //alert(jqXHR.statusText);
                /*弹出其他两个参数的信息*/
                //alert(textStatus);
                //alert(errorThrown);

            }
        });
        return false;
    });

    $(".btn-add-attachment").click(function () {
        $("#modalDialog-add-attach").modal("show");
        return false;
    });

    $(".add-attach").click(function () {
        var frm = $("#frmUploadFile");

        if (frm.find('[type="file"]')[0].files.length === 0) {
            alert("File Name is required.");
            return false;
        }
        if ($("#fuDesc").val() === "") {
            alert("Attach Description is required.");
            return false;
        }

        var formData = new FormData(),
        params = frm.serializeArray(),
                  files = frm.find('[type="file"]')[0].files;
        $.each(files, function (i, file) {
            formData.append('uploadedFiles-' + i, file);
        });

        $.each(params, function (i, val) {
            formData.append(val.name, val.value);
        });

        formData.append("projectId", $("#projectId").val());
        formData.append("subId", $("#subId").val());
        formData.append("type", $("#type").val());

        $.ajax({
            url: "Actions/BNBFormUploadFile.aspx",
            type: "post",
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (d) {
                try {
                    var rst = JSON.parse(d);
                    if (rst.ErrorCode === "0") {
                        //alert(rst.ErrorMessage);
                        location.reload();

                    } else {
                        alert(rst.ErrorMessage);
                    }
                } catch (e) {
                    alert(e);
                }
            }
        });
        return false;  // 阻止表单自动提交事件
    });

    // 动态格式化货币
    $("#t12, #t13, #t14, #t15, #t16, #t18, #t22, #t27,#t29,#t31,#t33,#t35,#t37,#t39,#t41,#t43,#t45,#t47,#t49,#t51, #t30, #t38, #t40").blur(function () {
        //console.log($(this).val());
        //console.log($(this).val().replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g, '$&,'));
        $(this).val($(this).val().replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g, '$&,'));

        return false;
    });


    $("#t57, #t59, #t61, #t63, #t65, #t67, #t69, #t23, #t24").keyup(function () {
        var ownerId = $(this).attr("id");
        $.ajax({
            url: "../People/Actions/searchPeople.aspx?top=10&searchKey=" + $(this).val(),
            type: "post",
            success: function (d) {
                try {
                    $("#" + ownerId).next().html("");
                    var rst = JSON.parse(d);
                    if (rst.length === 0) return false;
                    var html = "<table class='table table-condensed table-hover' style='background-color:white;padding:0;margin:0; border:1px solid gray;'>";
                    $.each(rst, function (i, item) {
                        html += "<tr><td><a href='javascript:void(0);' class='search-result-item' data-owner='" + ownerId + "'>" + item.EmployeeId + "</a></td><td><a href='javascript:void(0);' class='search-result-item' data-owner='" + ownerId + "'>" + item.PeopleNameEn + "</a></td></tr>";
                    });
                    html += "</table>";
                    $("#" + ownerId).next().html(html);
                } catch (e) {
                    alert(e);
                }
                return false;
            }
        });

        return false;
    });
    $("body").on("click", ".search-result-item", function () {
        var ownerId = "#" + $(this).data("owner");
        $(ownerId).data("empid", $(this).parent().parent().find("td:eq(0) a").html());
        $(ownerId).data("empname", $(this).parent().parent().find("td:eq(1) a").html());
        $(ownerId).val($(this).parent().parent().find("td:eq(1) a").html());
        $(this).parent().parent().parent().html("");
        //console.log($("#searchKey").data("empid"));
        //console.log($("#searchKey").data("empname"));
    });

    $(".reverse").click(function () {
        $.ajax({
            url: 'Actions/BidFormReverse.aspx?projectId=' + $("#projectId").val() + "&subId=" + $("#subId").val(),
            type: "post",
            datatype: "json",
            success: function () {
                alert("successful");
                window.location.reload();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                /*弹出jqXHR对象的信息*/
                alert(jqXHR.status);
            }
        });

        return false;
    });

    if ($("#islocked").val() === "1") {
        $(".save-change").remove();
        $(".ready-for-approval").remove();

        $('input').attr('readonly', 'readonly');
        $('input').attr('disabled', 'disabled');
        // $('input').removeAttr("disabled");
        $('select').attr('disabled', 'disabled');
        $('textarea').attr('disabled', 'disabled');
        $('a').attr('disabled', 'disabled');
        $(".expediting").attr('disabled', false);
    }
    if ($("#isAllApproved").val() === "1") {
        $(".expediting").remove();
    }
});