<%@ Page Language="C#" %>
<%
    var newTitle = Request["newTitle"];
    var newLevelNo = Request["newLevelNo"];
    var newPos = Request["newPos"];
    var newOwnerId = Request["newOwnerId"];
    var newParentId = Request["newParentId"];

    var db = new PPPEntities();
    if (string.IsNullOrEmpty(newPos))
    {
        newPos = "1";
    }
    if (string.IsNullOrEmpty(newTitle))
    {
        newTitle = "Title";
    }
    var organization = new TOrganization();
    if (!string.IsNullOrEmpty(newParentId))
    {
        organization.ParentId = Convert.ToInt32(newParentId);
    }
    organization.Id = db.TOrganization.Any() ? db.TOrganization.Count() + 1 : 1;
    organization.Title = newTitle;
    organization.LevelNo = Convert.ToInt32(newLevelNo);
    organization.LevelPos = Convert.ToInt32(newPos);
    if (!string.IsNullOrEmpty(newOwnerId))
    {
        organization.OwnerId = Convert.ToInt32(newOwnerId);
    }
    db.TOrganization.Add(organization);
    db.SaveChanges();

    var sb = new StringBuilder();
    sb.AppendFormat("{{");
    sb.AppendFormat("\"{0}\":\"{1}\", ", "ErrorCode", "0");
    sb.AppendFormat("\"{0}\":\"{1}\"  ", "ErrorMessage", "OK.");
    sb.AppendFormat("}}");
    Response.Write(sb.ToString());
    return;

%>